/**
 * Extended Malware Analysis Questions (mal51-70)
 * Lazy-loaded when user clicks "Load More Questions"
 */

const malwareExtended = [
    {
        id: 'mal51',
        title: 'Process Injection - Hollowing',
        points: 10,
        question: 'Malware creates svchost.exe in suspended state, unmaps legitimate code, writes malicious code, resumes thread. What technique is this?',
        type: 'radio',
        options: [
            { value: 'hollowing', text: 'Process Hollowing' },
            { value: 'dll_injection', text: 'DLL Injection' },
            { value: 'thread_hijacking', text: 'Thread Execution Hijacking' },
            { value: 'atom_bombing', text: 'AtomBombing' },
            { value: 'reflective_loading', text: 'Reflective DLL Loading' }
        ],
        correct: 'hollowing',
        explanation: 'ðŸ’‰ Process Hollowing (MITRE T1055.012): Creates legitimate process (svchost.exe) in SUSPENDED state via CREATE_SUSPENDED flag, calls NtUnmapViewOfSection (hollow out legitimate code), writes malicious code to memory (VirtualAllocEx/WriteProcessMemory), sets entry point (SetThreadContext), resumes thread (ResumeThread). Result: Task Manager shows svchost.exe but running attacker code. Detection: Monitor for suspended process creation, memory protection changes (PAGE_EXECUTE_READWRITE), parent-child relationship anomalies (Word.exe â†’ svchost.exe suspicious). Tools: Process Hacker (memory tab), Volatility (malfind), Sysmon EventID 10. Used by: Emotet, TrickBot, Dridex.'
    },
    {
        id: 'mal52',
        title: 'WMI Persistence',
        points: 9,
        question: 'Attacker creates permanent WMI event subscription executing PowerShell on system startup. Which components are involved? (Select ALL)',
        type: 'checkbox',
        options: [
            { value: 'event_filter', text: 'Event Filter (when to trigger)' },
            { value: 'event_consumer', text: 'Event Consumer (what to execute)' },
            { value: 'binding', text: 'Filter-to-Consumer Binding' },
            { value: 'scheduled_task', text: 'Scheduled Task' },
            { value: 'registry_key', text: 'Registry Run key' },
            { value: 'service', text: 'Windows Service' }
        ],
        correct: ['event_filter', 'event_consumer', 'binding'],
        explanation: 'ðŸ”® WMI Persistence (MITRE T1546.003): Three components required: 1) **Event Filter** (\_\_EventFilter) - defines trigger (e.g., system boot, user logon, timer), 2) **Event Consumer** (\_\_EventConsumer) - action to execute (CommandLineEventConsumer for scripts, ActiveScriptEventConsumer for VBScript), 3) **Binding** (\_\_FilterToConsumerBinding) - links filter to consumer. Stored in WMI repository (OBJECTS.DATA file), survives reboots, hard to detect. Detection: Autoruns (WMI tab), Get-WMIObject, WMI-Persistence-Detection.ps1. Defense: Monitor WMI event subscriptions, disable WMI if not needed, audit \_\_EventFilter creation. Tools: WMI Explorer, wmic. Used by: APT29, APT41.'
    },
    {
        id: 'mal53',
        title: 'Sandbox Evasion Techniques',
        points: 8,
        question: 'Malware checks for which indicators to detect sandbox/analysis environment? (Select ALL)',
        type: 'checkbox',
        options: [
            { value: 'vm_artifacts', text: 'VM artifacts (VMware Tools, VBox drivers)' },
            { value: 'sleep', text: 'Delays execution then checks if time really passed' },
            { value: 'user_interaction', text: 'Requires mouse clicks or specific user actions' },
            { value: 'cpu_cores', text: 'Number of CPU cores (VMs often have 1-2)' },
            { value: 'internet', text: 'Internet connectivity required' },
            { value: 'admin_rights', text: 'Checks if running as administrator' }
        ],
        correct: ['vm_artifacts', 'sleep', 'user_interaction', 'cpu_cores'],
        explanation: 'ðŸŽ­ Sandbox Evasion: Malware detects automated analysis environments. Techniques: 1) **VM Detection**: Check registry (HKLM\\HARDWARE\\Description\\System: SystemBiosVersion=VBOX), processes (vmtoolsd.exe, vboxservice.exe), MAC addresses (00:0C:29 = VMware), drivers (vmmouse.sys), 2) **Time Acceleration**: Sleep(300000) then check GetTickCount() - sandbox fast-forwards, 3) **User Interaction**: Wait for mouse movement/clicks (sandbox has none), 4) **Resource Checks**: <2 CPU cores, <2GB RAM, screen resolution 800x600 = sandbox. Also: DLL count, recent files, username checks. Defense: Bare metal analysis, realistic VM configs, interactive sandboxes (Joe Sandbox, ANY.RUN). Advanced: Sleep obfuscation, kernel driver checks.'
    },
    {
        id: 'mal54',
        title: 'COM Hijacking',
        points: 9,
        question: 'Malware modifies HKCU\\Software\\Classes\\CLSID\\{GUID}\\InProcServer32 to point to malicious DLL. When is the DLL loaded?',
        type: 'radio',
        options: [
            { value: 'com_usage', text: 'When any application uses that COM object' },
            { value: 'boot', text: 'Only on system boot' },
            { value: 'logon', text: 'Only on user logon' },
            { value: 'manual', text: 'Only when manually invoked' },
            { value: 'never', text: 'HKCU registry changes have no effect' }
        ],
        correct: 'com_usage',
        explanation: 'ðŸ”§ COM Hijacking (MITRE T1546.015): Component Object Model hijacking redirects COM object to malicious DLL. When application calls CoCreateInstance() for that CLSID, Windows loads attacker DLL instead of legitimate. HKCU overrides HKLM (user-level persistence, no admin needed). Common targets: {CLSID} for Office, Explorer, Edge. InProcServer32 (in-process server) vs LocalServer32 (out-of-process). Persistence: Triggered by normal application usage (opening Explorer â†’ malware runs). Detection: Autoruns (filter HKCU COM), Process Monitor (RegQueryValue CLSID), compare HKCU vs HKLM. Defense: Baseline COM objects, monitor registry changes. Used by: APT28, Lazarus. Similar: DLL Search Order Hijacking.'
    },
    {
        id: 'mal55',
        title: 'Memory Forensics - Volatility',
        points: 9,
        question: 'Volatility memory dump analysis shows process not in pslist but appears in psscan. What does this indicate?',
        type: 'radio',
        options: [
            { value: 'hidden_process', text: 'Process hidden by rootkit (DKOM)' },
            { value: 'exited_process', text: 'Process that recently exited' },
            { value: 'system_process', text: 'Protected system process' },
            { value: 'thread', text: 'Thread, not a process' },
            { value: 'artifact', text: 'Memory artifact only' }
        ],
        correct: 'hidden_process',
        explanation: 'ðŸ§  Memory Forensics: Volatility plugins: **pslist** (walks EPROCESS linked list - what OS reports), **psscan** (scans for EPROCESS structures in raw memory - finds hidden). Discrepancy = DKOM rootkit unlinked process from list. Also check: **pstree** (process tree), **psxview** (cross-reference 6 techniques), **malfind** (find injected code), **ldrmodules** (detect unlinked DLLs), **handles** (open handles), **cmdline** (command-line args). Exited process: May appear in psscan briefly (memory not zeroed). Analysis workflow: imageinfo â†’ pslist â†’ psscan â†’ compare â†’ malfind on hidden process. Tools: Volatility 2/3, Rekall. Profiles critical (Windows version-specific EPROCESS offsets).'
    },
    {
        id: 'mal56',
        title: 'Crypter vs Packer',
        points: 7,
        question: 'What is the primary difference between a crypter and a packer?',
        type: 'radio',
        options: [
            { value: 'av_evasion_focus', text: 'Crypter focuses on AV evasion, packer on compression' },
            { value: 'encryption_only', text: 'Crypter only encrypts, packer only compresses' },
            { value: 'identical', text: 'No difference - terms are interchangeable' },
            { value: 'runtime', text: 'Crypter decrypts at runtime, packer at install time' },
            { value: 'platform', text: 'Crypter is Windows-only, packer is cross-platform' }
        ],
        correct: 'av_evasion_focus',
        explanation: 'ðŸ” Crypter vs Packer: **Packer** = compress/obfuscate (UPX, ASPack, Themida) - original purpose: reduce file size, side effect: AV evasion. **Crypter** = specifically designed for AV evasion - encrypts payload, adds stub to decrypt at runtime, often polymorphic (changes signature each build). Crypter features: FUD (Fully UnDetectable), runtime polymorphism, anti-debug, sandbox checks. Both decrypt/decompress at runtime. Modern malware: Packed + Crypted (multi-layer). Tools: PEiD (detect packer), Detect It Easy, RDG Packer Detector. FUD crypters sold on underground forums ($$$). Defense: Behavioral analysis (ignore signature), memory scanning, entropy detection.'
    },
    {
        id: 'mal57',
        title: 'APT Persistence - PrintNightmare',
        points: 10,
        question: 'Attacker exploits PrintNightmare (CVE-2021-34527) to load malicious DLL. What type of vulnerability is this?',
        type: 'radio',
        options: [
            { value: 'rce_privesc', text: 'RCE + Local Privilege Escalation' },
            { value: 'xss', text: 'Cross-Site Scripting' },
            { value: 'sqli', text: 'SQL Injection' },
            { value: 'buffer_overflow', text: 'Buffer Overflow only' },
            { value: 'dos', text: 'Denial of Service' }
        ],
        correct: 'rce_privesc',
        explanation: 'ðŸ–¨ï¸ PrintNightmare (CVE-2021-34527): Windows Print Spooler vulnerability allowing remote code execution + privilege escalation. Attacker calls RpcAddPrinterDriverEx with UNC path to malicious DLL (\\\\attacker.com\\share\\evil.dll), Print Spooler runs as SYSTEM, loads DLL â†’ instant SYSTEM shell. Impact: Domain takeover (any domain user â†’ Domain Admin). Variants: CVE-2021-1675 (local privesc), CVE-2021-34527 (RCE). Mitigation: Disable Print Spooler (Stop-Service Spooler), apply patches, restrict Point and Print, disable inbound remote printing. Detection: EventID 316 (printer driver install), Sysmon DLL loads from UNC paths. Exploited in wild by: Vice Society ransomware, Magniber. CVSS 8.8.'
    },
    {
        id: 'mal58',
        title: 'Malware Family Classification',
        points: 8,
        question: 'Malware exhibits: Email spreads, modular architecture, downloads Cobalt Strike, steals credentials, moves laterally. Which family?',
        type: 'radio',
        options: [
            { value: 'emotet', text: 'Emotet' },
            { value: 'wannacry', text: 'WannaCry' },
            { value: 'stuxnet', text: 'Stuxnet' },
            { value: 'conficker', text: 'Conficker' },
            { value: 'zeus', text: 'Zeus' }
        ],
        correct: 'emotet',
        explanation: 'ðŸ¦  Emotet Family: Characteristics: 1) **Delivery**: Phishing emails with malicious Office macros/links, 2) **Modularity**: Loader downloads modules (banking trojan, info stealer, email harvester, lateral movement), 3) **Secondary Payloads**: Drops TrickBot, Qakbot, Ryuk ransomware, Cobalt Strike, 4) **Persistence**: Registry Run keys, WMI, scheduled tasks, 5) **C2**: HTTP(S) beaconing to compromised WordPress sites, 6) **Lateral Movement**: SMB, EternalBlue, brute force. Taken down (Jan 2021), returned (Nov 2021). Other families: WannaCry (ransomworm, EternalBlue), Stuxnet (ICS/SCADA), Conficker (worm, MS08-067), Zeus (banking trojan, form grabbing). Threat Intel: Indicators from CISA, ANY.RUN.'
    },
    {
        id: 'mal59',
        title: 'Thread Execution Hijacking',
        points: 9,
        question: 'Malware suspends legitimate thread in remote process, sets EIP/RIP to malicious code, resumes thread. What is this technique?',
        type: 'radio',
        options: [
            { value: 'thread_hijacking', text: 'Thread Execution Hijacking' },
            { value: 'process_hollowing', text: 'Process Hollowing' },
            { value: 'dll_injection', text: 'Classic DLL Injection' },
            { value: 'apc_injection', text: 'APC Injection' },
            { value: 'code_cave', text: 'Code Cave Injection' }
        ],
        correct: 'thread_hijacking',
        explanation: 'ðŸ§µ Thread Execution Hijacking (MITRE T1055.003): Modifies existing thread in running process. Steps: 1) OpenProcess (PROCESS_ALL_ACCESS), 2) OpenThread (existing thread), 3) SuspendThread, 4) GetThreadContext (get registers), 5) VirtualAllocEx (allocate memory for shellcode), 6) WriteProcessMemory (write shellcode), 7) SetThreadContext (set EIP/RIP to shellcode address), 8) ResumeThread. Advantages: No new process/thread creation (stealthier than CreateRemoteThread), no DLL on disk. Detection: Monitor SetThreadContext API, thread context changes, Sysmon EventID 8 (CreateRemoteThread - though not used here). vs Process Hollowing (creates new suspended process). Used by: Carberp, Duqu 2.0. Defense: EDR monitoring, memory protection.'
    },
    {
        id: 'mal60',
        title: 'Domain Generation Algorithm (DGA)',
        points: 8,
        question: 'Malware generates 10,000 domains daily using seed (date + hardcoded value). Attacker registers 1-5 domains. What is the purpose?',
        type: 'radio',
        options: [
            { value: 'c2_resilience', text: 'C2 resilience against domain takedowns/blacklists' },
            { value: 'ddos', text: 'DDoS attack infrastructure' },
            { value: 'phishing', text: 'Phishing domain generation' },
            { value: 'spam', text: 'Spam email relay' },
            { value: 'dns_amplification', text: 'DNS amplification attack' }
        ],
        correct: 'c2_resilience',
        explanation: 'ðŸŽ² DGA (Domain Generation Algorithm) - MITRE T1568.002: Malware and C2 both run same algorithm â†’ generate identical domain lists daily. Attacker registers few domains from list (malware tries all, eventually connects). Resilience: Takedown 1 domain, attacker registers another from same day\'s list. Example: Conficker generates 50,000/day, Kraken 800,000/day. Detection: DNS monitoring (high NXDOMAIN rate, random-looking domains, entropy analysis), machine learning (DGA vs legitimate), threat intel feeds. Seed variants: Date-based, Twitter trending topics, Bitcoin blockchain. Defense: Sinkhole known DGA domains, DNS RPZ, reverse-engineer algorithm (predict future domains). Tools: DGArchive, EXPOSURE, passive DNS analysis.'
    },
    {
        id: 'mal61',
        title: 'Anti-Debug Techniques',
        points: 8,
        question: 'Malware uses IsDebuggerPresent() API. What does this detect?',
        type: 'radio',
        options: [
            { value: 'user_mode_debugger', text: 'User-mode debugger attached (OllyDbg, x64dbg)' },
            { value: 'kernel_debugger', text: 'Kernel-mode debugger (WinDbg)' },
            { value: 'vm', text: 'Virtual machine environment' },
            { value: 'sandbox', text: 'Automated sandbox' },
            { value: 'all_analysis', text: 'All analysis tools' }
        ],
        correct: 'user_mode_debugger',
        explanation: 'ðŸ› Anti-Debug: IsDebuggerPresent() checks PEB (Process Environment Block) BeingDebugged flag. Returns TRUE if user-mode debugger attached (OllyDbg, x64dbg, WinDbg in user-mode). Bypass: Manually clear BeingDebugged flag (OllyDbg Hide Debugger plugin), patch API call, kernel driver (HideDebugger). Other anti-debug: CheckRemoteDebuggerPresent(), NtQueryInformationProcess (ProcessDebugPort), timing checks (RDTSC before/after, detect slow execution), hardware breakpoint detection (DR0-DR7 registers), OutputDebugString() exception, FindWindow("OLLYDBG"). Detection: Behavioral analysis, patch checks, ScyllaHide (anti-anti-debug). Advanced: NtSetInformationThread(ThreadHideFromDebugger), anti-step-over (INT3 spam).'
    },
    {
        id: 'mal62',
        title: 'Reflective DLL Injection',
        points: 10,
        question: 'DLL loaded into process memory without using LoadLibrary() or appearing in PEB module list. What technique?',
        type: 'radio',
        options: [
            { value: 'reflective_dll', text: 'Reflective DLL Injection' },
            { value: 'classic_injection', text: 'Classic DLL Injection' },
            { value: 'process_hollowing', text: 'Process Hollowing' },
            { value: 'dll_hijacking', text: 'DLL Hijacking' },
            { value: 'dll_preloading', text: 'DLL Preloading' }
        ],
        correct: 'reflective_dll',
        explanation: 'ðŸªž Reflective DLL Injection: DLL manually maps itself into memory, resolves imports, fixes relocations - acts as its own loader. No LoadLibrary() call, no disk file, not in PEB InMemoryOrderModuleList. Steps: 1) VirtualAllocEx (allocate memory), 2) WriteProcessMemory (write DLL), 3) CreateRemoteThread pointing to ReflectiveLoader function in DLL, 4) DLL finds kernel32.dll base (PEB walk), 5) Resolves GetProcAddress/LoadLibrary, 6) Processes imports, 7) Fixes relocations, 8) Calls DllMain. Used by: Cobalt Strike, Metasploit, PowerSploit. Detection: Memory scanning (Volatility malfind, PE Sieve), unbacked memory regions (not mapped from file), API hooking. vs Classic: Classic uses LoadLibrary (shows in modules list). Stephen Fewer\'s implementation (GitHub).'
    },
    {
        id: 'mal63',
        title: 'Malware C2 Channels',
        points: 7,
        question: 'Which protocols are used for covert C2 channels? (Select ALL)',
        type: 'checkbox',
        options: [
            { value: 'dns', text: 'DNS (TXT records, subdomains)' },
            { value: 'icmp', text: 'ICMP (ping data field)' },
            { value: 'http_steganography', text: 'HTTP with steganography in images' },
            { value: 'social_media', text: 'Social media (Twitter, GitHub)' },
            { value: 'smtp', text: 'SMTP (standard email protocol)' },
            { value: 'ftp', text: 'FTP only' }
        ],
        correct: ['dns', 'icmp', 'http_steganography', 'social_media'],
        explanation: 'ðŸ“¡ Covert C2 Channels: Advanced APTs use unconventional protocols. 1) **DNS Tunneling**: Encode data in subdomain (aGVsbG8=.evil.com), exfiltrate via TXT records (dig TXT), bypasses firewalls (DNS always allowed), tools: dnscat2, iodine. 2) **ICMP Tunneling**: Data in ping payload, tools: ptunnel, ICMPTunnel. 3) **Steganography**: Commands/data hidden in image metadata, LSB encoding, upload to Imgur/Pastebin, malware downloads/decodes. 4) **Social Media C2**: Commands via tweets (#malware), GitHub gists, comments on posts. APT29 used Twitter. SMTP/FTP = overt (obvious, easily blocked). Defense: DPI (deep packet inspection), DNS monitoring (query length, entropy), egress filtering, CASB. Covert â‰  encrypted.'
    },
    {
        id: 'mal64',
        title: 'Persistence - AppInit DLLs',
        points: 8,
        question: 'Malware adds path to HKLM\\SOFTWARE\\Microsoft\\Windows NT\\CurrentVersion\\Windows\\AppInit_DLLs. When is DLL loaded?',
        type: 'radio',
        options: [
            { value: 'user32_load', text: 'When any process loads User32.dll' },
            { value: 'boot', text: 'Only during system boot' },
            { value: 'logon', text: 'Only during user logon' },
            { value: 'explorer', text: 'Only when Explorer.exe starts' },
            { value: 'disabled', text: 'AppInit_DLLs disabled on modern Windows' }
        ],
        correct: 'user32_load',
        explanation: 'ðŸ”Œ AppInit_DLLs (MITRE T1546.010): Registry value causes DLL to load into EVERY process that loads User32.dll (almost all GUI apps). Extremely invasive persistence. Requirements: LoadAppInit_DLLs = 1, DLL must be signed (Windows 8+), Secure Boot restricts further. Impact: Global hooks, keylogging, API hooking, code injection. Detection: Autoruns, monitor registry key, Sysmon. Mitigation: Disable LoadAppInit_DLLs (set to 0), Secure Boot, code integrity checks. Note: Windows 8+ deprecated this, requires signed DLLs. Modern alternative: AppCertDlls (Application Certification DLLs). Used by: Poison Ivy, ZeroAccess. Similar but different: Winlogon Notify, Image File Execution Options.'
    },
    {
        id: 'mal65',
        title: 'Code Signing Abuse',
        points: 9,
        question: 'Malware uses stolen Authenticode certificate to sign malicious binary. What does this bypass?',
        type: 'checkbox',
        options: [
            { value: 'applocker', text: 'AppLocker publisher rules' },
            { value: 'smartscreen', text: 'Windows SmartScreen warnings' },
            { value: 'driver_signing', text: 'Driver signature enforcement' },
            { value: 'av_trust', text: 'Some AV/EDR trust heuristics' },
            { value: 'execution', text: 'All malware execution blocks' },
            { value: 'network_firewall', text: 'Network firewall rules' }
        ],
        correct: ['applocker', 'smartscreen', 'av_trust'],
        explanation: 'âœï¸ Code Signing Abuse: Stolen/compromised certificates sign malware as legitimate. Bypasses: 1) **AppLocker** publisher rules (allow signed by "TrustedCorp Inc"), 2) **SmartScreen** (no "unknown publisher" warning), 3) **User trust** (users more likely to run signed files), 4) **AV heuristics** (some AVs trust signed files more). Does NOT bypass: Signature-based detection (AV still scans), driver signing if cert not valid for drivers, network controls. Certificate sources: Stolen from companies, malware on build servers, compromised CAs. Examples: Stuxnet (Realtek/JMicron certs), Equation Group (multiple certs), SolarWinds (compromised build). Defense: Certificate reputation, revocation checking (CRL, OCSP), trust but verify. Attackers also: Self-signed certs (less effective), expired certs, timestamp manipulation.'
    },
    {
        id: 'mal66',
        title: 'Fileless Malware - Registry Payload',
        points: 9,
        question: 'PowerShell payload stored in HKCU\\Software\\Classes\\ms-settings\\shell\\open\\command. How is it executed?',
        type: 'radio',
        options: [
            { value: 'fodhelper_uac', text: 'Triggered by fodhelper.exe UAC bypass' },
            { value: 'auto_run', text: 'Runs automatically on boot' },
            { value: 'user_click', text: 'When user clicks ms-settings:// link' },
            { value: 'scheduled_task', text: 'Via scheduled task' },
            { value: 'wmi', text: 'Via WMI event consumer' }
        ],
        correct: 'fodhelper_uac',
        explanation: 'ðŸ”‘ Registry + UAC Bypass: fodhelper.exe (Feedback and Diagnostics) auto-elevates without UAC prompt. It checks HKCU\\Software\\Classes\\ms-settings for COM handler. Malware: 1) Writes payload to HKCU\\...\\ms-settings\\shell\\open\\command (default value = PowerShell one-liner), 2) Executes fodhelper.exe, 3) fodhelper reads registry, 4) Executes payload with high integrity (elevated). Fileless: No .exe on disk, payload in registry. Similar registry locations: exefile\\shell\\open\\command, mscfile\\shell\\open\\command. Other auto-elevate binaries: eventvwr.exe, sdclt.exe, ComputerDefaults.exe. Detection: Monitor registry writes to Classes\\ms-settings, fodhelper child processes, Sysmon EventID 12/13. Defense: Remove HKCU Classes keys, UAC "Always Notify", disable auto-elevation. MITRE T1548.002.'
    },
    {
        id: 'mal67',
        title: 'Malware Infrastructure - Fast Flux',
        points: 8,
        question: 'C2 domain resolves to different IP addresses every 5 minutes (hundreds of IPs). What is this technique?',
        type: 'radio',
        options: [
            { value: 'fast_flux', text: 'Fast Flux DNS' },
            { value: 'domain_fronting', text: 'Domain Fronting' },
            { value: 'cdn', text: 'CDN load balancing' },
            { value: 'dga', text: 'Domain Generation Algorithm' },
            { value: 'round_robin', text: 'Round-robin DNS' }
        ],
        correct: 'fast_flux',
        explanation: 'âš¡ Fast Flux: C2 resilience technique using rapidly-changing DNS A records (single-flux) or NS records (double-flux). Single-flux: Domain â†’ hundreds of compromised proxy IPs (change every 3-10 mins, very low TTL). Proxies relay to backend C2 servers. Benefits: Hard to block (too many IPs), survive takedowns (backend servers hidden). Double-flux: Also rotates authoritative name servers. Detection: Very low TTL (<300s), high number of unique IPs per domain, short-lived IPs, geo-distributed IPs, ASN diversity, reverse DNS analysis. vs DGA (generates new domains, not IPs). vs Domain Fronting (uses CDN/cloud). Tools: PassiveTotal, DomainTools, EXPOSURE. Used by: Storm Worm, Conficker, Zeus. Defense: Threat intel feeds, DNS sinkholing, monitor flux networks.'
    },
    {
        id: 'mal68',
        title: 'APC Queue Injection',
        points: 9,
        question: 'Malware calls QueueUserAPC() to inject code into alertable thread. When does code execute?',
        type: 'radio',
        options: [
            { value: 'alertable_state', text: 'When thread enters alertable state (SleepEx, WaitForSingleObjectEx)' },
            { value: 'immediately', text: 'Immediately after QueueUserAPC' },
            { value: 'next_boot', text: 'On next system boot' },
            { value: 'user_action', text: 'When user performs specific action' },
            { value: 'never', text: 'APC queue injection doesn\'t work on modern Windows' }
        ],
        correct: 'alertable_state',
        explanation: 'ðŸ“ž APC Queue Injection (MITRE T1055.004): Asynchronous Procedure Call queued to thread via QueueUserAPC(). APC executes when thread enters alertable wait state (calling SleepEx, WaitForSingleObjectEx, MsgWaitForMultipleObjectsEx with bAlertable=TRUE). Steps: 1) Find alertable thread in target process (check thread state), 2) VirtualAllocEx (allocate memory), 3) WriteProcessMemory (write shellcode), 4) QueueUserAPC (queue shellcode function), 5) Wait for thread to become alertable. Advantages: No CreateRemoteThread (less suspicious), leverages existing threads. Used by: Carberp, ZeroT. Detection: Monitor QueueUserAPC calls (Sysmon EventID 8 won\'t catch - no new thread), memory injection patterns. Early Bird injection variant: Queue APC to new suspended thread before it starts.'
    },
    {
        id: 'mal69',
        title: 'AMSI Bypass Techniques',
        points: 8,
        question: 'PowerShell script contains: [Ref].Assembly.GetType(\'System.Management.Automation.AmsiUtils\').GetField(\'amsiInitFailed\',\'NonPublic,Static\').SetValue($null,$true). What is this?',
        type: 'radio',
        options: [
            { value: 'amsi_bypass', text: 'AMSI (Anti-Malware Scan Interface) bypass' },
            { value: 'uac_bypass', text: 'UAC bypass' },
            { value: 'execution_policy', text: 'PowerShell execution policy bypass' },
            { value: 'logging_disable', text: 'Script block logging disable' },
            { value: 'credential_dump', text: 'Credential dumping' }
        ],
        correct: 'amsi_bypass',
        explanation: 'ðŸ›¡ï¸ AMSI Bypass: Windows AMSI scans scripts (PowerShell, VBScript, JScript) before execution. Bypass sets amsiInitFailed = true â†’ AMSI thinks it failed to initialize â†’ stops scanning. Other bypasses: 1) Patch amsi.dll in memory (modify AmsiScanBuffer function), 2) Unload amsi.dll, 3) Obfuscation (break AMSI signatures: A"+"MSI), 4) Downgrade to PowerShell v2 (no AMSI), 5) Reflection to overwrite AmsiContext. Detection: Look for AMSI strings in scripts, monitor .NET reflection to AmsiUtils, EDR detects AMSI tampering, script block logging (EventID 4104) logs before AMSI bypass. Defense: Protected Process Light (PPL) for PowerShell, Constrained Language Mode, monitor amsi.dll modifications. Windows Defender + third-party AVs use AMSI. Bypass research: @RastaMouse, @_xpn_.'
    },
    {
        id: 'mal70',
        title: 'Supply Chain Attack Indicators',
        points: 9,
        question: 'Legitimate software update mechanism compromised to distribute malware. What should analysts look for? (Select ALL)',
        type: 'checkbox',
        options: [
            { value: 'cert_mismatch', text: 'Update signed with different certificate than usual' },
            { value: 'hash_mismatch', text: 'Update hash doesn\'t match vendor-published values' },
            { value: 'unexpected_network', text: 'Software connecting to unexpected IPs/domains' },
            { value: 'file_size', text: 'Update file size significantly different from previous' },
            { value: 'slow_download', text: 'Slower download speed than normal' },
            { value: 'user_prompts', text: 'More user prompts than usual' }
        ],
        correct: ['cert_mismatch', 'hash_mismatch', 'unexpected_network', 'file_size'],
        explanation: 'ðŸ”— Supply Chain Attack (MITRE T1195): Compromise software development/distribution. SolarWinds: Malicious DLL in signed updates. Indicators: 1) **Certificate anomaly**: Different issuer/subject, cert issued recently, expired cert, 2) **Hash mismatch**: Verify SHA256 against vendor site (if not compromised), 3) **Unexpected network**: Update.exe connecting to non-vendor IPs, check VirusTotal/passive DNS, 4) **File size**: 5MB update now 12MB (added payload), or smaller (removed features), 5) **Behavioral**: Persistence mechanisms, unexpected child processes, C2 beaconing. Also: Build timestamp anomalies, version number inconsistencies. Prevention: SBOM (Software Bill of Materials), vendor security assessments, network segmentation (updates via proxy), binary diffing. Cases: CCleaner (2017), ASUS Live Update (ShadowHammer 2019), Kaseya VSA (2021). Detection: EDR, threat hunting, vendor notifications.'
    }
];

// Export for use in main application
if (typeof module !== 'undefined' && module.exports) {
    module.exports = malwareExtended;
}
